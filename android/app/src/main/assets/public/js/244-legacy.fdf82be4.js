"use strict";(self["webpackChunkpapillon"]=self["webpackChunkpapillon"]||[]).push([[244],{7585:(e,t,n)=>{n.d(t,{Bq:()=>a,eB:()=>s,iH:()=>l,xD:()=>i});n(6699),n(3948),n(7658),n(8862),n(1817);var o=n(3162);const s=e=>{const t=new Date(e),n=t.getUTCDay(),o=JSON.parse(localStorage.getItem("disabledDays")),s=JSON.parse(localStorage.getItem("disableHolidays")),l=JSON.parse(localStorage.getItem("daysOff")),a=JSON.parse(localStorage.getItem("holidays"));if(l&&s){const e=l.find((e=>{const n=new Date(e.date);if(t.toDateString()==n.toDateString())return!0}));if(e)return!1}if(a&&s){const e=a.find((e=>{const n=new Date(e.startDate),o=new Date(e.endDate);if(t>n&&t<=o)return!0}));if(e)return!1}return!o||!o.includes(n)};function l(){return new Promise(((e,t)=>{try{const t="https://calendrier.api.gouv.fr/jours-feries/metropole.json",n="https://data.education.gouv.fr/api/records/1.0/search/?dataset=fr-en-calendrier-scolaire&lang=fr&exclude.population=Enseignants",o=(new Date).getFullYear(),s=(new Date).getMonth(),l=localStorage.getItem("acadName"),a=s>=8?o+"-"+(o+1):o-1+"-"+o;fetch(t).then((e=>e.json())).then((e=>{const t=[];for(const[n,o]of Object.entries(e)){const e=new Date(n),s=e.getFullYear();if(s!=a.split("-")[0]&&s!=a.split("-")[1])continue;const l=o,i={date:e,name:l};t.push(i)}localStorage.setItem("daysOff",JSON.stringify(t))})).catch((e=>console.error("[Fetch Days off]: "+e)));const i=[];fetch(n+"&refine.location="+l+"&refine.annee_scolaire="+a).then((e=>e.json())).then((t=>{t.records.forEach((e=>{const t=e.fields.end_date,n=e.fields.start_date,o=e.fields.description,s={endDate:t,startDate:n,name:o};i.push(s)})),localStorage.setItem("holidays",JSON.stringify(i)),e(JSON.stringify(i))})).catch((e=>console.error("[Fetch Holidays]: "+e)))}catch(n){console.error("[datetimePicker Fetching]: "+n),o.Z.presentToast("Erreur lors de la récupération des jours fériés et des vacances scolaires","danger",n),t(n)}}))}function a(){const e=(new Date).getFullYear(),t=(new Date).getMonth(),n=t>=8?e+"-"+(e+1):e-1+"-"+e,o=JSON.parse(localStorage.getItem("disableHolidays"));let s=JSON.parse(localStorage.getItem("holidays"));if(s&&(s=s.find((e=>"Vacances d'Été"==e.name))),s&&o){const e=new Date(s.startDate);return e.setDate(e.getDate()+1),e.toISOString().split("T")[0]}return n.split("-")[1]+"-12-31"}function i(){const e=(new Date).getFullYear(),t=(new Date).getMonth(),n=t>=8?e+"-"+(e+1):e-1+"-"+e,o=JSON.parse(localStorage.getItem("disableHolidays"));let s=JSON.parse(localStorage.getItem("holidays"));if(s&&(s=s.find((e=>"Vacances d'Été"==e.name))),s&&o){const e=new Date(n.split("-")[0]+"-"+s.endDate.split("-")[1]+"-"+s.endDate.split("-")[2]);return e.toISOString().split("T")[0]}return n.split("-")[0]+"-01-01"}},7244:(e,t,n)=>{n.r(t),n.d(t,{default:()=>gt});var o=n(6252);function s(e,t,n,s,l,a){var i=(0,o.up)("ion-nav");return(0,o.wg)(),(0,o.j4)(i,{root:l.component,ref:"page"},null,8,["root"])}var l=n(5274),a=n(3577);const i=e=>((0,o.dD)("data-v-1f66d1bc"),e=e(),(0,o.Cn)(),e),r={class:"content"},u=i((()=>(0,o._)("img",{src:"/assets/welcome/papillon.svg",alt:"Logo de Papillon",class:"logo"},null,-1))),c=i((()=>(0,o._)("p",{class:"description"},"Bienvenue sur Papillon, votre nouvelle app scolaire que vous risquez d'adorer !",-1))),d={class:"buttons"},p=i((()=>(0,o._)("div",{class:"logo_services"},[(0,o._)("img",{alt:"Logo",src:"/assets/welcome/pronote_logo.png"}),(0,o._)("img",{alt:"Logo",src:"/assets/welcome/ecoledirecte_logo.png"}),(0,o._)("img",{alt:"Logo",src:"/assets/welcome/skolengo_logo.png"})],-1))),m={class:"version"},g={class:"version_text"};function h(e,t,n,s,l,i){const h=(0,o.up)("ion-button"),f=(0,o.up)("ion-nav-link"),w=(0,o.up)("ion-content");return(0,o.wg)(),(0,o.j4)(w,{fullscreen:!0},{default:(0,o.w5)((()=>[(0,o._)("div",r,[u,c,(0,o._)("div",d,[(0,o.Wm)(f,{"router-direction":"forward",component:e.LoginSelect},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{mode:"md",color:"dark",fill:"solid",onClick:e.goNormalStatusBar},{default:(0,o.w5)((()=>[(0,o.Uk)(" Se connecter avec "),p])),_:1},8,["onClick"])])),_:1},8,["component"]),(0,o.Wm)(h,{class:"no_service",mode:"md",color:"dark",fill:"clear",onClick:e.displayServiceMsg},{default:(0,o.w5)((()=>[(0,o.Uk)(" Je ne vois pas mon service scolaire ")])),_:1},8,["onClick"])]),(0,o._)("div",m,[(0,o._)("p",g,[(0,o._)("span",null,"version "+(0,a.zw)(e.appVersion)+"-"+(0,a.zw)(e.appPlatform),1)])])])])),_:1})}var f=n(4147),w=n(9895),_=n(7806),b=n(2136),v=n(942);const C=e=>((0,o.dD)("data-v-609d81e0"),e=e(),(0,o.Cn)(),e),S=C((()=>(0,o._)("p",null,"Services disponibles",-1))),A=C((()=>(0,o._)("img",{alt:"Logo",src:"/assets/welcome/pronote_logo.png"},null,-1))),F=C((()=>(0,o._)("h2",null,"Pronote",-1))),k=C((()=>(0,o._)("p",null,"Utilisez Pronote et votre ENT pour vous connecter",-1))),E=C((()=>(0,o._)("img",{alt:"Logo",src:"/assets/welcome/ecoledirecte_logo.png"},null,-1))),y=C((()=>(0,o._)("h2",null,"EcoleDirecte",-1))),D=C((()=>(0,o._)("p",null,"Utilisez vos identifiants EcoleDirecte pour vous connecter",-1))),W=C((()=>(0,o._)("img",{alt:"Logo",src:"/assets/welcome/skolengo_logo.png"},null,-1))),I=C((()=>(0,o._)("h2",null,"ENT régional Skolengo",-1))),B=C((()=>(0,o._)("p",null,"Utilisez vos identifiants d'un ENT Skolengo pour vous connecter",-1)));function x(e,t,n,s,l,a){const i=(0,o.up)("ion-back-button"),r=(0,o.up)("ion-buttons"),u=(0,o.up)("ion-title"),c=(0,o.up)("ion-toolbar"),d=(0,o.up)("ion-header"),p=(0,o.up)("ion-label"),m=(0,o.up)("ion-list-header"),g=(0,o.up)("ion-avatar"),h=(0,o.up)("ion-item"),f=(0,o.up)("ion-nav-link"),w=(0,o.up)("ion-list"),_=(0,o.up)("ion-content");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(r,{slot:"start"},{default:(0,o.w5)((()=>[(0,o.Wm)(i,{class:"only-ios",text:"Retour"}),(0,o.Wm)(i,{class:"only-md"})])),_:1}),(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Sélectionnez votre service scolaire")])),_:1})])),_:1})])),_:1}),(0,o.Wm)(_,{fullscreen:!0},{default:(0,o.w5)((()=>[(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[S])),_:1})])),_:1}),(0,o.Wm)(f,{"router-direction":"forward",component:e.SchoolSelection},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{detail:"true",button:""},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{slot:"start"},{default:(0,o.w5)((()=>[A])),_:1}),(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[F,k])),_:1})])),_:1})])),_:1},8,["component"]),(0,o.Wm)(f,{"router-direction":"forward",component:e.EDLoginForm},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{button:"",detail:"true"},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{slot:"start"},{default:(0,o.w5)((()=>[E])),_:1}),(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[y,D])),_:1})])),_:1})])),_:1},8,["component"]),(0,o.Wm)(f,{"router-direction":"forward",component:e.SkolengoSelection},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{button:"",detail:"true"},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{slot:"start"},{default:(0,o.w5)((()=>[W])),_:1}),(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[I,B])),_:1})])),_:1})])),_:1},8,["component"])])),_:1})])),_:1})],64)}n(3948),n(1637),n(2062);var P=n(8903);const U=e=>((0,o.dD)("data-v-874c6fa6"),e=e(),(0,o.Cn)(),e),L=U((()=>(0,o._)("p",null,"Établissements disponibles",-1))),O=U((()=>(0,o._)("h2",null,"En attente de la permission...",-1))),z=U((()=>(0,o._)("p",null,"Veuillez autoriser la permission de géolocalisation pour rechercher les établissements à proximité.",-1))),T=U((()=>(0,o._)("h2",null,"Recherche des établissements...",-1))),q=U((()=>(0,o._)("p",null,null,-1))),N=U((()=>(0,o._)("h2",null,"Pas d'établissements par ici...",-1))),Z=U((()=>(0,o._)("p",null,"Essayez une autre vile ou un autre code postal",-1))),V=U((()=>(0,o._)("h2",null,"Emplacement introuvable",-1))),R=U((()=>(0,o._)("h2",null,'Permission "Géolocalisation" refusée',-1))),$=U((()=>(0,o._)("p",null,"Nous ne pouvons pas chercher les établissements à proximité. Veuillez autoriser la géolocalisation et réessayez.",-1))),j=U((()=>(0,o._)("p",null,"Autres options",-1))),G=U((()=>(0,o._)("h2",null,"Se connecter avec une URL",-1))),H=U((()=>(0,o._)("p",null,"Utilisez l'URL fournie par votre établissement",-1))),M=U((()=>(0,o._)("h2",null,"Utiliser le compte démo",-1))),J=U((()=>(0,o._)("p",null,"Permet de tester Papillon à l'aide du compte de démonstration",-1))),Y=U((()=>(0,o._)("h2",null,"Se connecter avec un QR-Code",-1))),X=U((()=>(0,o._)("p",null,"Scannez le QR-Code de l'interface Pronote",-1))),Q=U((()=>(0,o._)("p",null,"Options avancées",-1))),K=U((()=>(0,o._)("h2",null,"Changer d'API",-1))),ee=U((()=>(0,o._)("p",null,"Utiliser une autre API que celle de Papillon que vous hébergez vous-mêmes.",-1))),te=U((()=>(0,o._)("br",null,null,-1))),ne=U((()=>(0,o._)("br",null,null,-1))),oe={class:"loginPage"},se={class:"loginIntro"},le=U((()=>(0,o._)("img",{src:"assets/welcome/pronote_logo.png",alt:"Pronote Logo",class:"logo"},null,-1))),ae={class:"introData"},ie=U((()=>(0,o._)("h2",null,"Connexion à Papillon",-1))),re={class:"description"},ue={key:0,class:"isEduconnectLogin"},ce=U((()=>(0,o._)("div",{class:"loginConditions"},[(0,o.Uk)(" Vos données ne sont pas stockées sur nos serveurs. En vous connectant avec cette application, vous acceptez les "),(0,o._)("a",{href:"https://docs.getpapillon.xyz/documents/politique-de-confidentialite-et-mentions-legales"},"conditions d'utilisation"),(0,o.Uk)(" de Papillon. ")],-1)));function de(e,t,n,s,l,i){const r=(0,o.up)("ion-back-button"),u=(0,o.up)("ion-buttons"),c=(0,o.up)("ion-title"),d=(0,o.up)("ion-spinner"),p=(0,o.up)("ion-toolbar"),m=(0,o.up)("ion-searchbar"),g=(0,o.up)("ion-header"),h=(0,o.up)("ion-label"),f=(0,o.up)("ion-list-header"),w=(0,o.up)("ion-icon"),_=(0,o.up)("ion-item"),b=(0,o.up)("ion-list"),v=(0,o.up)("ion-button"),C=(0,o.up)("B"),S=(0,o.up)("ion-input"),A=(0,o.up)("ion-content"),F=(0,o.up)("ion-modal");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o.Wm)(u,{slot:"start"},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{class:"only-ios",text:"Retour"}),(0,o.Wm)(r,{class:"only-md"})])),_:1}),(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Connexion à Pronote")])),_:1}),(0,o.Wm)(u,{slot:"end",style:{"padding-right":"10px"}},{default:(0,o.w5)((()=>[e.isLoading?((0,o.wg)(),(0,o.j4)(d,{key:0})):(0,o.kq)("",!0)])),_:1})])),_:1}),(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,{autocomplete:"off",ref:"postalInput",placeholder:"Chercher avec un code postal...",type:"number",onIonInput:t[0]||(t[0]=t=>e.getPostal(t)),onIonClear:t[1]||(t[1]=t=>e.clearEtabs()),maxlength:"5"},null,512)])),_:1})])),_:1}),(0,o.Wm)(A,{fullscreen:!0},{default:(0,o.w5)((()=>[(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[L])),_:1})])),_:1}),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.etabs,((t,n)=>((0,o.wg)(),(0,o.j4)(_,{button:"",detail:"true",key:n,onClick:n=>e.loginToEtab(t.url,t.cp)},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{class:"icon",slot:"start",ios:e.schoolOutline,md:e.schoolSharp},null,8,["ios","md"]),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o._)("h2",null,(0,a.zw)(t.nomEtab),1),(0,o._)("p",null,(0,a.zw)(t.url),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),e.permissionWait?((0,o.wg)(),(0,o.j4)(_,{key:0},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{class:"icon",slot:"start",ios:e.businessOutline,md:e.businessSharp},null,8,["ios","md"]),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[O,z])),_:1})])),_:1})):(0,o.kq)("",!0),e.etabsFetching?((0,o.wg)(),(0,o.j4)(_,{key:1},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{class:"icon",slot:"start",ios:e.businessOutline,md:e.businessSharp},null,8,["ios","md"]),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[T,q])),_:1})])),_:1})):(0,o.kq)("",!0),e.etabsEmpty?((0,o.wg)(),(0,o.j4)(_,{key:2},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{class:"icon",slot:"start",ios:e.businessOutline,md:e.businessSharp},null,8,["ios","md"]),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[N,Z])),_:1})])),_:1})):(0,o.kq)("",!0),e.locationFailed?((0,o.wg)(),(0,o.j4)(_,{key:3},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{class:"icon",slot:"start",ios:e.navigateOutline,md:e.navigateSharp},null,8,["ios","md"]),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[V,(0,o._)("p",null,'Impossible de trouver des établissements à "'+(0,a.zw)(e.terms)+'"',1)])),_:1})])),_:1})):(0,o.kq)("",!0),e.permissionDeny?((0,o.wg)(),(0,o.j4)(_,{key:4},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{class:"icon",slot:"start",ios:e.navigateOutline,md:e.navigateSharp},null,8,["ios","md"]),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[R,$])),_:1})])),_:1})):(0,o.kq)("",!0)])),_:1}),(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[j])),_:1})])),_:1}),(0,o.Wm)(_,{button:"",onClick:t[2]||(t[2]=t=>e.URLLogin())},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{class:"icon",slot:"start",ios:e.linkOutline,md:e.linkSharp},null,8,["ios","md"]),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[G,H])),_:1})])),_:1}),(0,o.Wm)(_,{button:"",onClick:t[3]||(t[3]=t=>e.loginToDemo())},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{class:"icon",slot:"start",ios:e.personCircleOutline,md:e.personCircleSharp},null,8,["ios","md"]),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[M,J])),_:1})])),_:1}),(0,o.Wm)(_,{button:"",disabled:""},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{class:"icon",slot:"start",ios:e.qrCodeOutline,md:e.qrCodeSharp},null,8,["ios","md"]),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[Y,X])),_:1})])),_:1})])),_:1}),(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[Q])),_:1})])),_:1}),(0,o.Wm)(_,{button:"",onClick:t[4]||(t[4]=t=>e.changeApi())},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{class:"icon",slot:"start",ios:e.serverOutline,md:e.serverSharp},null,8,["ios","md"]),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[K,ee])),_:1})])),_:1})])),_:1}),te,ne,(0,o.Wm)(F,{ref:"loginModal",trigger:"open-loginModal",swipeToClose:!0},{default:(0,o.w5)((()=>[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Se connecter")])),_:1}),(0,o.Wm)(u,{slot:"end"},{default:(0,o.w5)((()=>[(0,o.Wm)(v,{onClick:t[5]||(t[5]=t=>e.dismiss())},{default:(0,o.w5)((()=>[(0,o.Uk)("Fermer")])),_:1})])),_:1})])),_:1})])),_:1}),(0,o.Wm)(A,null,{default:(0,o.w5)((()=>[(0,o._)("div",oe,[(0,o._)("div",se,[le,(0,o._)("div",ae,[ie,(0,o._)("p",re,[(0,o.Uk)("Vous souhaitez vous connecter à "),(0,o.Wm)(C,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Pronote")])),_:1}),(0,o.Uk)(" en utilisant "),(0,o.Wm)(C,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.displayCas),1)])),_:1}),(0,o.Uk)(".")]),e.isEduconnectLogin?((0,o.wg)(),(0,o.iD)("p",ue,"Cet ENT utilise ÉduConnect, merci de rentrer les identifiants de ce service.")):(0,o.kq)("",!0)])]),(0,o.Wm)(b,{class:"loginInput"},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{mode:"md",fill:"solid",class:"userIn"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{position:"floating"},{default:(0,o.w5)((()=>[(0,o.Uk)("Identifiant")])),_:1}),(0,o.Wm)(S,{ref:"user",type:"text",placeholder:"j.dupont6",autocomplete:"username"},null,512)])),_:1}),(0,o.Wm)(_,{mode:"md",fill:"solid",class:"passIn"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{position:"floating"},{default:(0,o.w5)((()=>[(0,o.Uk)("Mot de passe")])),_:1}),(0,o.Wm)(S,{ref:"pass",type:"password",placeholder:"*********"},null,512)])),_:1}),(0,o.Wm)(v,{class:"loginBtn",onClick:e.login,expand:"block",mode:"md"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Se connecter ")])),_:1},8,["onClick"])])),_:1}),ce])])),_:1})])),_:1},512)])),_:1})],64)}n(4916),n(5306),n(7658),n(8862),n(6699),n(2801);var pe=n(6154),me=n(5137),ge=n(3162),he=n(7585);const fe=(0,w.fo)("Geolocation",{web:()=>n.e(642).then(n.bind(n,6642)).then((e=>new e.GeolocationWeb))}),we=(0,o.aZ)({name:"FolderPage",components:{IonBackButton:l.oU,IonItem:l.Ie,IonList:l.q_,IonIcon:l.gu,IonSearchbar:l.VI,IonModal:l.ki,IonListHeader:l.yh,IonSpinner:l.PQ,IonInput:l.pK,IonButton:l.YG},setup(){return{linkOutline:P.m5T,linkSharp:P.kR0,qrCodeOutline:P.bo5,qrCodeSharp:P.rXd,schoolOutline:P.SGw,schoolSharp:P.cS2,serverOutline:P.bhR,serverSharp:P.pGB,businessOutline:P.c1X,businessSharp:P.fYQ,navigateOutline:P.xzF,navigateSharp:P.Iqq,personCircleOutline:P.XMB,personCircleSharp:P.ycb}},mounted(){this.getENTs(),this.GetLocation()},methods:{decodeEntities(e){const t=/&(nbsp|amp|quot|lt|gt|Eacute|eacute|Egrave|egrave);/g,n={nbsp:" ",amp:"&",quot:'"',lt:"<",gt:">",Eacute:"É",eacute:"é",Egrave:"È",egrave:"è"};return e.replace(t,(function(e,t){return n[t]})).replace(/&#(\d+);/gi,(function(e,t){const n=parseInt(t,10);return String.fromCharCode(n)}))},async getENTs(){const e=this.$api+"/infos",t=await l.G0.create({message:"Obtention des ENTS..."});t.present(),pe.Z.get(e).then((e=>{setTimeout((()=>{t.dismiss()}),300),this.ents=e.data.ent_list})).catch((e=>{setTimeout((()=>{t.dismiss()}),300),console.error(e),ge.Z.presentError("Impossible de récupérer les ENTS. La connexion risque de ne pas fonctionner.","danger",e)}))},async GetLocation(){const e=await fe.getCurrentPosition().catch((e=>{1===e.code&&(this.permissionWait=!1,this.permissionDeny=!0)})),t=e.coords.latitude,n=e.coords.longitude;this.isLoading=!0,this.findEstablishments(t,n)},async createEntPicker(e){const t=[];for(let o=0;o<e.cas.length;o++)t.push({text:e.cas[o].name,handler:()=>{const t={etab:e.etab.toLowerCase(),cas:e.cas[o].py,cas_name:e.cas[o].name,educonnect:1==e.cas[o].educonnect};this.displayLogin(t)}});t.push({text:"Annuler",role:"cancel",handler:()=>{ge.Z.presentToast("Vous devez choisir un ENT pour continuer.","danger")},data:{action:"cancel"}});const n=await l.BO.create({header:"Choisissez votre méthode de connexion",subHeader:"Plusieurs méthodes de connexion sont disponibles pour votre établissement. Choisissez celle que vous souhaitez utiliser.",buttons:t});await n.present()},getPostal(e){let t=e.detail.value;if(5==t.trim().length){if(t=t.normalize("NFD").replace(/[\^`\xA8\xAF\xB4\xB7\xB8\u02B0-\u034E\u0350-\u0357\u035D-\u0362\u0374\u0375\u037A\u0384\u0385\u0483-\u0487\u0559\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u064B-\u0652\u0657\u0658\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F5\u0818\u0819\u0898-\u089F\u08C9-\u08D2\u08E3-\u08FE\u093C\u094D\u0951-\u0954\u0971\u09BC\u09CD\u0A3C\u0A4D\u0ABC\u0ACD\u0AFD-\u0AFF\u0B3C\u0B4D\u0B55\u0BCD\u0C3C\u0C4D\u0CBC\u0CCD\u0D3B\u0D3C\u0D4D\u0DCA\u0E47-\u0E4C\u0E4E\u0EBA\u0EC8-\u0ECC\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F82-\u0F84\u0F86\u0F87\u0FC6\u1037\u1039\u103A\u1063\u1064\u1069-\u106D\u1087-\u108D\u108F\u109A\u109B\u135D-\u135F\u1714\u1715\u17C9-\u17D3\u17DD\u1939-\u193B\u1A75-\u1A7C\u1A7F\u1AB0-\u1ABE\u1AC1-\u1ACB\u1B34\u1B44\u1B6B-\u1B73\u1BAA\u1BAB\u1C36\u1C37\u1C78-\u1C7D\u1CD0-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1D2C-\u1D6A\u1DC4-\u1DCF\u1DF5-\u1DFF\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2CEF-\u2CF1\u2E2F\u302A-\u302F\u3099-\u309C\u30FC\uA66F\uA67C\uA67D\uA67F\uA69C\uA69D\uA6F0\uA6F1\uA700-\uA721\uA788-\uA78A\uA7F8\uA7F9\uA8C4\uA8E0-\uA8F1\uA92B-\uA92E\uA953\uA9B3\uA9C0\uA9E5\uAA7B-\uAA7D\uAABF-\uAAC2\uAAF6\uAB5B-\uAB5F\uAB69-\uAB6B\uABEC\uABED\uFB1E\uFE20-\uFE2F\uFF3E\uFF40\uFF70\uFF9E\uFF9F\uFFE3\u{102E0}\u{10780}-\u{10785}\u{10787}-\u{107B0}\u{107B2}-\u{107BA}\u{10AE5}\u{10AE6}\u{10D22}-\u{10D27}\u{10EFD}-\u{10EFF}\u{10F46}-\u{10F50}\u{10F82}-\u{10F85}\u{11046}\u{11070}\u{110B9}\u{110BA}\u{11133}\u{11134}\u{11173}\u{111C0}\u{111CA}-\u{111CC}\u{11235}\u{11236}\u{112E9}\u{112EA}\u{1133C}\u{1134D}\u{11366}-\u{1136C}\u{11370}-\u{11374}\u{11442}\u{11446}\u{114C2}\u{114C3}\u{115BF}\u{115C0}\u{1163F}\u{116B6}\u{116B7}\u{1172B}\u{11839}\u{1183A}\u{1193D}\u{1193E}\u{11943}\u{119E0}\u{11A34}\u{11A47}\u{11A99}\u{11C3F}\u{11D42}\u{11D44}\u{11D45}\u{11D97}\u{13447}-\u{13455}\u{16AF0}-\u{16AF4}\u{16B30}-\u{16B36}\u{16F8F}-\u{16F9F}\u{16FF0}\u{16FF1}\u{1AFF0}-\u{1AFF3}\u{1AFF5}-\u{1AFFB}\u{1AFFD}\u{1AFFE}\u{1CF00}-\u{1CF2D}\u{1CF30}-\u{1CF46}\u{1D167}-\u{1D169}\u{1D16D}-\u{1D172}\u{1D17B}-\u{1D182}\u{1D185}-\u{1D18B}\u{1D1AA}-\u{1D1AD}\u{1E030}-\u{1E06D}\u{1E130}-\u{1E136}\u{1E2AE}\u{1E2EC}-\u{1E2EF}\u{1E8D0}-\u{1E8D6}\u{1E944}-\u{1E946}\u{1E948}-\u{1E94A}]/gu,""),""==t.trim())return this.clearEtabs(),void(this.locationFailed=!1);this.etabs=[],this.etabsEmpty=!1,this.locationFailed=!1,this.terms=t,this.isLoading=!0,pe.Z.get("https://cors.api.getpapillon.xyz/https://positionstack.com/geo_api.php?query=france+"+t,{headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET,PUT,POST,DELETE,PATCH,OPTIONS","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept, Authorization","Access-Control-Allow-Credentials":"true"}}).then((e=>{const t=e.data.data,n=t[0].latitude,o=t[0].longitude;this.foundCity=t[0].locality,this.findEstablishments(n,o)})).catch((e=>{this.isLoading=!1,this.locationFailed=!0,console.error("[Get Postal Code]: "+e),ge.Z.presentError("Une erreur s'est produite pour obtenir votre code postal.","danger",e.stack)}))}else 0==t.trim().length&&(this.clearEtabs(),this.locationFailed=!1)},findEstablishments(e,t){this.permissionWait=!1,this.etabsFetching=!0,fetch("https://www.index-education.com/swie/geoloc.php",{headers:{accept:"*/*","accept-language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","content-type":"application/x-www-form-urlencoded; charset=UTF-8","sec-ch-ua":'"Chromium";v="110", "Not A(Brand";v="24", "Google Chrome";v="110"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"cross-site","sec-gpc":"1"},referrer:"http://localhost:8081/",referrerPolicy:"strict-origin-when-cross-origin",body:"data=%7B%22nomFonction%22%3A%22geoLoc%22%2C%22lat%22%3A"+e+"%2C%22long%22%3A"+t+"%7D",method:"POST",mode:"cors",credentials:"omit"}).then((e=>e.json())).then((e=>{this.etabs=e,this.etabsFetching=!1,0==this.etabs.length?this.etabsEmpty=!0:this.etabsEmpty=!1,"{}"==JSON.stringify(e)?this.locationFailed=!0:this.locationFailed=!1;for(let t=0;t<this.etabs.length;t++)""!=this.etabs[t].url&&null!=this.etabs[t].url||this.etabs.splice(t,1);for(let t=0;t<this.etabs.length;t++)this.etabs[t].nomEtab=this.decodeEntities(this.etabs[t].nomEtab);setTimeout((()=>{this.isLoading=!1}),200)})).catch((n=>{console.error("[Find Establishment]: "+n),this.retries<3?(setTimeout((()=>{this.findEstablishments(e,t)}),1e3),this.retries++):(this.isLoading=!1,this.locationFailed=!0,ge.Z.presentError("Une erreur s'est produite pour obtenir les établissements à proximité.","danger",n.stack))}))},clearEtabs(){this.etabs=[],this.etabsEmpty=!0},async URLLogin(){const e=await l.Cl.create({header:"Connexion avec une URL Pronote",message:"Veuillez entrer l'URL de votre établissement Pronote.",mode:"md",buttons:[{text:"Annuler",role:"cancel",cssClass:"btn_secondary",handler:()=>{e.dismiss()}},{text:"Se connecter",handler:e=>{let t=e.url;""!=t?(t.includes("eleve.html")&&(t=t.split("/").slice(0,-1).join("/")),this.loginToEtab(t,null,!0)):ge.Z.presentToast("Veuillez entrer une URL valide.","danger")}}],inputs:[{name:"url",type:"url",placeholder:"https://XXXXXXXY.index-education.net/pronote"}]});await e.present()},loginToDemo(){this.loginToEtab("https://demo.index-education.net/pronote"),setTimeout((()=>{this.$refs.user.$el.value="demonstration",this.$refs.pass.$el.value="pronotevs",this.login()}),1e3)},async loginToEtab(e,t,n=!1){e=e.toLowerCase();let o=e.toLowerCase(),s=!1;t&&(t.toString().startsWith("35")||t.toString().startsWith("22")||t.toString().startsWith("56")||t.toString().startsWith("29"))&&(s=!0),this.isLoading=!0,o.includes("eleve.html")||(o.includes("/pronote/")?o+="eleve.html":o+="/eleve.html");const a=await l.G0.create({message:"Veuillez patienter..."});a.present(),pe.Z.get(`https://api.androne.dev/papillon-v4/redirect.php?url=${encodeURIComponent(o)}`).then((t=>{this.isLoading=!1,a.dismiss();const l=t.data.url;let i=l.split("/")[2];i=i.split("/")[0]||i,i.includes("index-education.net")&&(i="index-education.net"),i.includes("pronote.toutatice.fr")&&(i="www.toutatice.fr");const r=this.ents.filter((e=>(e.url.includes("*.")&&(i=i.split(".")[1],e.url=e.url.split(".")[1]),e.url==i)));let u=r[0];if(0==r.length)n?(r.push({name:"Connexion directe via Pronote",url:"index-education.net",py:"",educonnect:!1}),u=r[0].py):ge.Z.presentToast(`Aucun CAS trouvé pour ${i}.`,"danger");else if(1==r.length&&"index-education.net"==r[0].url)u=r[0].py;else if(r.length>=1){r.push({name:"Connexion directe via Pronote",url:"index-education.net",py:"",educonnect:!1});const e={etab:o.toLowerCase(),cas:r};return void this.createEntPicker(e)}if(s)this.loginToEtab(e.replace("index-education.net","pronote.toutatice.fr"));else{o=o.toLowerCase();const e={etab:o,cas:u,cas_name:r[0].name,educonnect:1==r[0].educonnect};this.displayLogin(e)}}))},displayLogin(e){this.etabUrl=e.etab,this.etabCas=e.cas,this.displayCas=e.cas_name,this.isEduconnectLogin=e.educonnect,this.$refs.loginModal.$el.present()},dismiss(){this.$refs.loginModal.$el.dismiss()},async changeApi(){const e=await l.Cl.create({header:"Redémarrage requis",message:"Vous devez redémarrer l'application pour appliquer les changements.",mode:"md",buttons:[{text:"Plus tard",role:"cancel",cssClass:"btn_secondary",handler:()=>{t.dismiss()}},{text:"Quitter",handler:()=>{me.g.exitApp()}}]}),t=await l.Cl.create({header:"URL personnalisée",message:"Entrez l'URL personnalisée de l'API",mode:"md",buttons:[{text:"Réinitialiser",role:"reset",cssClass:"btn_secondary",handler:()=>{ge.Z.presentToast("API personnalisée réinitialisée","danger"),localStorage.removeItem("customApiUrl"),t.dismiss()}},{text:"OK",handler:t=>{localStorage.setItem("customApiUrl",t.url),ge.Z.presentToast("URL d'API personnalisée enregistrée","success"),e.present()}}],inputs:[{name:"url",type:"url",placeholder:"https://api.example.com",value:localStorage.getItem("customApiUrl")}]});await t.present()},async login(){const e=this.$api,t=this.$refs.user.$el.value,n=this.$refs.pass.$el.value,o=this.etabCas;let s=this.etabUrl;""==o&&(s+="?login=true");const a=new Headers;a.append("Content-Type","application/x-www-form-urlencoded");const i=new URLSearchParams;i.append("url",s),i.append("ent",o),i.append("username",t),i.append("password",n);const r={method:"POST",headers:a,body:i,redirect:"follow"},u=await l.G0.create({message:"Connexion en cours..."});u.present(),fetch(e+"/generatetoken",r).then((e=>e.json())).then((async e=>{if(e.token){const l=e.token;localStorage.token=l,localStorage.loggedIn=!0,localStorage.loginData=btoa(JSON.stringify({username:t,password:n,cas:o,url:s})),localStorage.loginService="pronote",localStorage.setItem("disabledDays",JSON.stringify([0]));const a="https://data.education.gouv.fr/api/records/1.0/search/?dataset=fr-en-adresse-et-geolocalisation-etablissements-premier-et-second-degre&q=&facet=code_postal_uai&facet=nature_uai_libe&facet=libelle_academie&timezone=Europe%2FParis";pe.Z.get(a+"&refine.numero_uai="+s.split("/")[2].split(".")[0].toUpperCase()).then((e=>e.json())).then((e=>{e.records.length>0&&localStorage.setItem("acadName",e.records[0].fields.libelle_academie)})),await(0,he.iH)(),window.location.replace("/")}else u.dismiss(),e.error.includes("probably wrong login information")||e.error.includes("probably bad username/password")?ge.Z.presentError("Identifiants incorrects.","danger",e.error):"Missing username"==e.error?ge.Z.presentToast("Veuillez entrer un identifiant.","danger"):"Missing password"==e.error?ge.Z.presentToast("Veuillez entrer un mot de passe.","danger"):"Your IP address is suspended."==e.error?ge.Z.presentError("Une erreur s'est produite","danger","L'adresse IP de nos serveurs est suspendue pour votre établissement. S'il vous plaît réessayez dans quelques heures."):ge.Z.presentError("Une erreur s'est produite.","danger",e.error)}))}},data(){return{presentingElement:null,terms:"",foundCity:"",etabsEmpty:!1,locationFailed:!1,etabs:[],isLoading:!1,etabUrl:"",etabCas:"",displayCas:"",etabName:"",ents:[],retries:0,etabsFetching:!1,permissionDeny:!1,permissionWait:!0}}});var _e=n(3744);const be=(0,_e.Z)(we,[["render",de],["__scopeId","data-v-874c6fa6"]]),ve=be,Ce=e=>((0,o.dD)("data-v-1bd7bb5a"),e=e(),(0,o.Cn)(),e),Se={class:"loginPage"},Ae=Ce((()=>(0,o._)("div",{class:"alphaMessage"},[(0,o._)("span",{class:"material-symbols-outlined mdls icon"},"sms_failed"),(0,o._)("div",{class:"alphaText"},[(0,o._)("h2",null,"EcoleDirecte est instable"),(0,o._)("p",{class:"description"},"L'utilisation d'EcoleDirecte avec Papillon est encore extrêmement instable. L'équipe de Papillon ne serait être tenue responsable de tout dysfonctionnement.")])],-1))),Fe={class:"loginIntro"},ke=Ce((()=>(0,o._)("img",{src:"assets/welcome/ecoledirecte_logo.png",alt:"Pronote Logo",class:"logo"},null,-1))),Ee={class:"introData"},ye=Ce((()=>(0,o._)("h2",null,"Connexion à Papillon",-1))),De={class:"description"},We=Ce((()=>(0,o._)("div",{class:"loginConditions"},[(0,o.Uk)(" Vos données ne sont pas stockées sur nos serveurs. En vous connectant avec cette application, vous acceptez les "),(0,o._)("a",{href:"https://getpapillon.xyz/privacy.pdf"},"conditions d'utilisation"),(0,o.Uk)(" de Papillon. ")],-1)));function Ie(e,t,n,s,l,a){const i=(0,o.up)("ion-back-button"),r=(0,o.up)("ion-buttons"),u=(0,o.up)("ion-title"),c=(0,o.up)("ion-spinner"),d=(0,o.up)("ion-toolbar"),p=(0,o.up)("ion-header"),m=(0,o.up)("B"),g=(0,o.up)("ion-label"),h=(0,o.up)("ion-input"),f=(0,o.up)("ion-item"),w=(0,o.up)("ion-button"),_=(0,o.up)("ion-list"),b=(0,o.up)("ion-content");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(r,{slot:"start"},{default:(0,o.w5)((()=>[(0,o.Wm)(i,{class:"only-ios",text:"Retour"}),(0,o.Wm)(i,{class:"only-md"})])),_:1}),(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Connexion à EcoleDirecte")])),_:1}),(0,o.Wm)(r,{slot:"end",style:{"padding-right":"10px"}},{default:(0,o.w5)((()=>[e.isLoading?((0,o.wg)(),(0,o.j4)(c,{key:0})):(0,o.kq)("",!0)])),_:1})])),_:1})])),_:1}),(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o._)("div",Se,[Ae,(0,o._)("div",Fe,[ke,(0,o._)("div",Ee,[ye,(0,o._)("p",De,[(0,o.Uk)("Vous souhaitez vous connecter à "),(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Uk)("EcoleDirecte")])),_:1})])])]),(0,o.Wm)(_,{class:"loginInput"},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{mode:"md",fill:"solid",class:"userIn"},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{position:"floating"},{default:(0,o.w5)((()=>[(0,o.Uk)("Identifiant")])),_:1}),(0,o.Wm)(h,{ref:"user",type:"text",placeholder:"j.dupont6",autocomplete:"username"},null,512)])),_:1}),(0,o.Wm)(f,{mode:"md",fill:"solid",class:"passIn"},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{position:"floating"},{default:(0,o.w5)((()=>[(0,o.Uk)("Mot de passe")])),_:1}),(0,o.Wm)(h,{ref:"pass",type:"password",placeholder:"*********"},null,512)])),_:1}),(0,o.Wm)(w,{class:"loginBtn",onClick:e.login,expand:"block",mode:"md"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Se connecter ")])),_:1},8,["onClick"])])),_:1}),We])])),_:1})],64)}var Be=n(415),xe=n(7907);const Pe=(0,o.aZ)({name:"FolderPage",components:{IonBackButton:l.oU,IonItem:l.Ie,IonList:l.q_,IonSpinner:l.PQ,IonInput:l.pK,IonButton:l.YG},setup(){return{linkOutline:P.m5T,linkSharp:P.kR0,qrCodeOutline:P.bo5,qrCodeSharp:P.rXd,schoolOutline:P.SGw,schoolSharp:P.cS2,serverOutline:P.bhR,serverSharp:P.pGB,businessOutline:P.c1X,businessSharp:P.fYQ,navigateOutline:P.xzF,navigateSharp:P.Iqq,personCircleOutline:P.XMB,personCircleSharp:P.ycb}},mounted(){},methods:{decodeEntities(e){const t=/&(nbsp|amp|quot|lt|gt|Eacute|eacute|Egrave|egrave);/g,n={nbsp:" ",amp:"&",quot:'"',lt:"<",gt:">",Eacute:"É",eacute:"é",Egrave:"È",egrave:"è"};return e.replace(t,(function(e,t){return n[t]})).replace(/&#(\d+);/gi,(function(e,t){const n=parseInt(t,10);return String.fromCharCode(n)}))},async login(){const e="https://api.ecoledirecte.com/v3",t=this.$refs.user.$el.value,n=this.$refs.pass.$el.value,o={headers:{"Content-Type":"application/x-www-form-urlencoded","x-token":""}},s=`data={\n\t\t\t\t\t\t"uuid": "",\n\t\t\t\t\t\t"identifiant": "${encodeURIComponent(t)}",\n\t\t\t\t\t\t"motdepasse": "${encodeURIComponent(n)}",\n\t\t\t\t\t\t"isReLogin": false\n\t\t\t\t\t}`,a=await l.G0.create({message:"Connexion en cours..."});a.present(),pe.Z.post(e+"/login.awp",s,o).then((async e=>{const o=e.data;if(o.token){const e=o.token,s=o.data.accounts[0];await(0,Be.Z)(s.id,e).then((e=>{s.periods=e})),o.data.accounts[0].profile.photo=await(0,xe.Z)(o.data.accounts[0]),localStorage.UserCache=JSON.stringify(s),localStorage.token=e,localStorage.loggedIn=!0,localStorage.loginData=btoa(JSON.stringify({username:t,password:n})),localStorage.loginService="ecoledirecte",localStorage.setItem("disabledDays",JSON.stringify([0])),window.location.replace("/")}else a.dismiss(),505==o.code?ge.Z.presentError(`${o.message}`,"danger",o.error):ge.Z.presentError("Une erreur s'est produite.","danger",o.error)}))}},data(){return{presentingElement:null,terms:"",isLoading:!1,retries:0}}}),Ue=(0,_e.Z)(Pe,[["render",Ie],["__scopeId","data-v-1bd7bb5a"]]),Le=Ue,Oe=e=>((0,o.dD)("data-v-3c5bf312"),e=e(),(0,o.Cn)(),e),ze=Oe((()=>(0,o._)("p",null,"Instances Skolengo disponibles",-1))),Te=["src"];function qe(e,t,n,s,l,i){const r=(0,o.up)("ion-back-button"),u=(0,o.up)("ion-buttons"),c=(0,o.up)("ion-title"),d=(0,o.up)("ion-toolbar"),p=(0,o.up)("ion-header"),m=(0,o.up)("ion-label"),g=(0,o.up)("ion-list-header"),h=(0,o.up)("ion-avatar"),f=(0,o.up)("ion-item"),w=(0,o.up)("ion-nav-link"),_=(0,o.up)("ion-list"),b=(0,o.up)("ion-content");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(u,{slot:"start"},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{class:"only-ios",text:"Retour"}),(0,o.Wm)(r,{class:"only-md"})])),_:1}),(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Séléctionnez votre instance Skolengo")])),_:1})])),_:1})])),_:1}),(0,o.Wm)(b,{fullscreen:!0},{default:(0,o.w5)((()=>[(0,o.Wm)(_,null,{default:(0,o.w5)((()=>[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[ze])),_:1})])),_:1}),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(Object.keys(e.ApiUrl).filter((t=>Object.keys(e.ApiVersion).includes(t))),(t=>((0,o.wg)(),(0,o.j4)(w,{key:t,"router-direction":"forward",component:e.SkolengoLoginForm,componentProps:{ent:t}},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{button:"",detail:"true"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{slot:"start"},{default:(0,o.w5)((()=>[(0,o._)("img",{alt:"Logo",src:"/assets/welcome/skolengo/"+t+".png"},null,8,Te)])),_:2},1024),(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o._)("h2",null,(0,a.zw)(e.ApiName[t]),1),(0,o._)("p",null,"Utilisez vos identifiants "+(0,a.zw)(e.ApiName[t])+" pour vous connecter",1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["component","componentProps"])))),128))])),_:1})])),_:1})],64)}const Ne=e=>((0,o.dD)("data-v-7f5e6dc8"),e=e(),(0,o.Cn)(),e),Ze={class:"loginPage"},Ve={class:"alphaMessage"},Re=Ne((()=>(0,o._)("span",{class:"material-symbols-outlined mdls icon"},"sms_failed",-1))),$e={class:"alphaText"},je=Ne((()=>(0,o._)("p",{class:"description"},"L'utilisation des ENT régionaux basés sur Skolengo avec Papillon est encore extrêmement instable. L'équipe de Papillon ne serait être tenue responsable de tout dysfonctionnement.",-1))),Ge={class:"loginIntro"},He=["src"],Me={class:"introData"},Je=Ne((()=>(0,o._)("h2",null,"Connexion à Papillon",-1))),Ye={class:"description"},Xe=Ne((()=>(0,o._)("div",{class:"loginConditions"},[(0,o.Uk)(" Vos données ne sont pas stockées sur nos serveurs. En vous connectant avec cette application, vous acceptez les "),(0,o._)("a",{href:"https://getpapillon.xyz/privacy.pdf"},"conditions d'utilisation"),(0,o.Uk)(" de Papillon. ")],-1)));function Qe(e,t,n,s,l,i){const r=(0,o.up)("ion-back-button"),u=(0,o.up)("ion-buttons"),c=(0,o.up)("ion-title"),d=(0,o.up)("ion-spinner"),p=(0,o.up)("ion-toolbar"),m=(0,o.up)("ion-header"),g=(0,o.up)("B"),h=(0,o.up)("ion-label"),f=(0,o.up)("ion-input"),w=(0,o.up)("ion-item"),_=(0,o.up)("ion-button"),b=(0,o.up)("ion-list"),v=(0,o.up)("ion-content");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o.Wm)(u,{slot:"start"},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{class:"only-ios",text:"Retour"}),(0,o.Wm)(r,{class:"only-md"})])),_:1}),(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Connexion à "+(0,a.zw)(e.ApiName[this.ent]),1)])),_:1}),(0,o.Wm)(u,{slot:"end",style:{"padding-right":"10px"}},{default:(0,o.w5)((()=>[e.isLoading?((0,o.wg)(),(0,o.j4)(d,{key:0})):(0,o.kq)("",!0)])),_:1})])),_:1})])),_:1}),(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o._)("div",Ze,[(0,o._)("div",Ve,[Re,(0,o._)("div",$e,[(0,o._)("h2",null,(0,a.zw)(e.ApiName[this.ent])+" est instable",1),je])]),(0,o._)("div",Ge,[(0,o._)("img",{src:"/assets/welcome/skolengo/"+e.ent+".png",alt:"Logo",class:"logo"},null,8,He),(0,o._)("div",Me,[Je,(0,o._)("p",Ye,[(0,o.Uk)("Vous souhaitez vous connecter à "),(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.ApiName[this.ent]),1)])),_:1})])])]),(0,o.Wm)(b,{class:"loginInput"},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{mode:"md",fill:"solid",class:"userIn"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{position:"floating"},{default:(0,o.w5)((()=>[(0,o.Uk)("Identifiant")])),_:1}),(0,o.Wm)(f,{ref:"user",type:"text",placeholder:"j.dupont6",autocomplete:"username"},null,512)])),_:1}),(0,o.Wm)(w,{mode:"md",fill:"solid",class:"passIn"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{position:"floating"},{default:(0,o.w5)((()=>[(0,o.Uk)("Mot de passe temporaire ou jeton")])),_:1}),(0,o.Wm)(f,{ref:"pass",type:"password",placeholder:"*********"},null,512)])),_:1}),(0,o.Wm)(_,{class:"loginBtn",onClick:e.login,expand:"block",mode:"md"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Se connecter ")])),_:1},8,["onClick"])])),_:1}),Xe])])),_:1})],64)}var Ke=n(2021);const et=(0,o.aZ)({name:"FolderPage",props:["ent"],computed:{ApiVersion(){return Ke.ApiVersion},ApiUrl(){return Ke.ApiUrl},ApiName(){return Ke.ApiName}},components:{IonBackButton:l.oU,IonItem:l.Ie,IonList:l.q_,IonSpinner:l.PQ,IonInput:l.pK,IonButton:l.YG},setup(){return{linkOutline:P.m5T,linkSharp:P.kR0,qrCodeOutline:P.bo5,qrCodeSharp:P.rXd,schoolOutline:P.SGw,schoolSharp:P.cS2,serverOutline:P.bhR,serverSharp:P.pGB,businessOutline:P.c1X,businessSharp:P.fYQ,navigateOutline:P.xzF,navigateSharp:P.Iqq,personCircleOutline:P.XMB,personCircleSharp:P.ycb}},mounted(){},methods:{decodeEntities(e){const t=/&(nbsp|amp|quot|lt|gt|Eacute|eacute|Egrave|egrave);/g,n={nbsp:" ",amp:"&",quot:'"',lt:"<",gt:">",Eacute:"É",eacute:"é",Egrave:"È",egrave:"è"};return e.replace(t,(function(e,t){return n[t]})).replace(/&#(\d+);/gi,(function(e,t){const n=parseInt(t,10);return String.fromCharCode(n)}))},async login(){const e=await l.G0.create({message:"Connexion en cours..."}),t=this.ent,n=this.$refs.user.$el.value,o=this.$refs.pass.$el.value;if(e.present(),125===o.length){const n=new Ke.Kdecole(o,Ke.ApiVersion[t],0,"https://cors.api.getpapillon.xyz/"+Ke.ApiUrl[t]);n.starting().then((()=>{localStorage.token=o,localStorage.loggedIn=!0,localStorage.loginService="skolengo",localStorage.ent=t,window.location.replace("/")})).catch((t=>{e.dismiss(),ge.Z.presentError(`${t.message}`,"danger",t)}))}else Ke.Kdecole.login(n,o,Ke.ApiVersion[t],"https://cors.api.getpapillon.xyz/"+Ke.ApiUrl[t]).then((e=>{localStorage.token=e,localStorage.loggedIn=!0,localStorage.loginService="skolengo",localStorage.ent=t,window.location.replace("/")})).catch((t=>{e.dismiss(),ge.Z.presentError(`${t.message}`,"danger",t)}))}},data(){return{presentingElement:null,terms:"",isLoading:!1,retries:0}}}),tt=(0,_e.Z)(et,[["render",Qe],["__scopeId","data-v-7f5e6dc8"]]),nt=tt,ot=(0,o.aZ)({name:"FolderPage",components:{IonItem:l.Ie,IonLabel:l.Q$,IonList:l.q_,IonAvatar:l.BJ,IonNavLink:l.Qx,IonListHeader:l.yh,IonBackButton:l.oU},setup(){return{logoDiscord:P.P3s,logoGithub:P.oE5,bugOutline:P.HwZ,bugSharp:P.pf,informationCircleOutline:P.yo2,informationCircleSharp:P.ztb,globeOutline:P.jgG,globeSharp:P.qBw}},computed:{ApiName(){return Ke.ApiName},ApiVersion(){return Ke.ApiVersion},ApiUrl(){return Ke.ApiUrl}},methods:{setOpen(e){setTimeout((()=>{this.isOpen=e}),200)},nextSlide(){setTimeout((()=>{this.$refs.swiper.$el.swiper.slideNext()}),200)},goOldStatusBar(){"android"===w.dV.getPlatform()&&(b.A_.setStyle({style:b.bg.Dark}),b.A_.setBackgroundColor({color:"#12D4A6"}))}},data(){return{SkolengoLoginForm:nt,appVersion:f.version,appPlatform:w.dV.getPlatform()}}}),st=(0,_e.Z)(ot,[["render",qe],["__scopeId","data-v-3c5bf312"]]),lt=st,at=(0,o.aZ)({name:"FolderPage",components:{IonItem:l.Ie,IonLabel:l.Q$,IonList:l.q_,IonAvatar:l.BJ,IonNavLink:l.Qx,IonListHeader:l.yh,IonBackButton:l.oU},setup(){return{logoDiscord:P.P3s,logoGithub:P.oE5,bugOutline:P.HwZ,bugSharp:P.pf,informationCircleOutline:P.yo2,informationCircleSharp:P.ztb,globeOutline:P.jgG,globeSharp:P.qBw}},computed:{},methods:{login(){const e=this.$api,t=JSON.parse(localStorage.loginData),n=t.username,o=t.password,s=t.url,l=t.cas,a=new Headers;a.append("Content-Type","application/x-www-form-urlencoded");const i=new URLSearchParams;i.append("url",s),i.append("ent",l),i.append("username",n),i.append("password",o);const r={method:"POST",headers:a,body:i,redirect:"follow"};fetch(e+"/generatetoken",r).then((e=>e.json())).then((e=>{"notfound"!==e&&"expired"!==e?(localStorage.token=e.token,localStorage.loggedIn=!0,location.href="/"):(localStorage.loggedIn=!1,localStorage.loginData=[],location.href="/login")}))},setOpen(e){setTimeout((()=>{this.isOpen=e}),200)},nextSlide(){setTimeout((()=>{this.$refs.swiper.$el.swiper.slideNext()}),200)},goOldStatusBar(){"android"===w.dV.getPlatform()&&(b.A_.setStyle({style:b.bg.Dark}),b.A_.setBackgroundColor({color:"#12D4A6"}))}},data(){return{SchoolSelection:ve,EDLoginForm:Le,SkolengoSelection:lt,appVersion:f.version,appPlatform:w.dV.getPlatform()}},mounted(){}}),it=(0,_e.Z)(at,[["render",x],["__scopeId","data-v-609d81e0"]]),rt=it,ut=(0,o.aZ)({name:"FolderPage",components:{},setup(){return{IonButton:l.YG}},methods:{goNormalStatusBar(){setTimeout((()=>{if("android"===w.dV.getPlatform()){const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;e?(b.A_.setBackgroundColor({color:"#1C1B1F"}),b.A_.setStyle({style:b.bg.Dark})):(b.A_.setBackgroundColor({color:"#ffffff"}),b.A_.setStyle({style:b.bg.Light})),e?v.v.setColor({color:"#1C1B1F",darkButtons:!1}):v.v.setColor({color:"#ffffff",darkButtons:!0})}}),200)},async openURL(e){await _.A.open({url:e})},async displayServiceMsg(){const e=await l.Cl.create({header:"Vous ne voyez pas votre service scolaire",message:"Papillon fonctionne grâce à une équipe de développeurs volontaires. Si vous pensez pouvoir ajouter un service à Papillon, n'hésitez pas à contribuer.",mode:"md",buttons:[{text:"Contribuer",handler:()=>{this.openURL("https://github.com/PapillonApp/Papillon")},cssClass:"btn_secondary"},{text:"Je comprends"}]});await e.present()}},data(){return{LoginSelect:rt,appVersion:f.version,appPlatform:w.dV.getPlatform(),status:""}},mounted(){"android"===w.dV.getPlatform()&&(b.A_.setStyle({style:b.bg.Dark}),b.A_.setBackgroundColor({color:"#12D4A6"}),v.v.setColor({color:"#186F5A",darkButtons:!1}))}}),ct=(0,_e.Z)(ut,[["render",h],["__scopeId","data-v-1f66d1bc"]]),dt=ct,pt={components:{IonNav:l.O1},data:function(){return{component:dt}}},mt=(0,_e.Z)(pt,[["render",s]]),gt=mt}}]);
//# sourceMappingURL=244-legacy.fdf82be4.js.map